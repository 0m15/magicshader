import{RawShaderMaterial,Color}from"three";import{GUI}from"dat.gui";var magicUniformsToThree=function(r){var e={};for(var t in r){var a=r[t].json.value;"bool"===r[t].type&&(a=!!a),"string"==typeof a&&(a=new Color(a)),e[t]={value:a}}return e},parseShaders=function(r,e){var t=parseGLSL(r),a=parseGLSL(e);return Object.assign({},t,a)},parseGLSL=function(source){var lines=source.match(/uniform (.+?) (.+?);.+\/\/.+ms\((.+?)\)/gm);if(!lines)return{};var uniforms={};return lines.forEach(function(line){var ref=line.match(/uniform (.+?) (.+?);.+\/\/.+ms\((.+?)\)/),type=ref[1],name=ref[2],jsonString=ref[3],json={};try{eval("json = "+jsonString)}catch(r){throw new Error(r)}json.value||(json.value=0),uniforms[name]={name:name,type:type,json:json}}),uniforms},gui=new GUI({name:"MagicShader"}),spectorGui,id=0,MagicShader=function(r){function e(e){var t=parseShaders(e.vertexShader,e.fragmentShader);e.uniforms=Object.assign({},magicUniformsToThree(t),e.uniforms),r.call(this,e),this.params=e,this.magicUniforms=t,this.displayName=this.params.name||"Shader n. "+ ++id,this.spector(),this.bindUI()}return r&&(e.__proto__=r),(e.prototype=Object.create(r&&r.prototype)).constructor=e,e.prototype.bindUI=function(){var r=this;this.gui&&gui.removeFolder(this.gui),this.gui=gui.addFolder(this.displayName),Object.keys(this.magicUniforms).forEach(function(e){var t=r.magicUniforms[e],a=t.json,i=r.uniforms[e],s=r.gui.addFolder(a.name||"ðŸ”® "+t.type+" - "+e);if(i.value instanceof Color)s.addColor(a,"value").onChange(function(r){i.value.set(r)}).listen();else if(Array.isArray(a.value))Object.keys(i.value).forEach(function(r){var e=s.add(i.value,r);a.step&&e.step(a.step),a.range&&a.range[r]&&2===a.range[r].length&&(e.min(a.range[r][0]),e.max(a.range[r][1])),e.listen()});else{var o=s.add(i,"value");a.step&&o.step(a.step),a.options&&o.options(a.options),a.range&&2===a.range.length&&(o.min(a.range[0]),o.max(a.range[1])),o.listen()}})},e.prototype.spector=function(){var r=this;window.spector&&(spectorGui||(spectorGui=gui.addFolder("ðŸ“ˆ Spector"),this.spectorFPS=0,setInterval(function(){r.spectorFPS=spector.getFps()},200),spectorGui.add(this,"spectorFPS").name("FPS").listen(),spectorGui.add(this,"capture")),this.checkProgram=this.checkProgram.bind(this),this.checkProgramInterval=setInterval(this.checkProgram,200))},e.prototype.capture=function(){var r=document.querySelector("canvas");spector.captureNextFrame(r)},e.prototype.checkProgram=function(){this.program&&this.program.program&&(this.program.program.__SPECTOR_Object_TAG.displayText=this.displayName,this.program.vertexShader.__SPECTOR_Object_TAG.displayText="Vertex - "+this.displayName,this.program.fragmentShader.__SPECTOR_Object_TAG.displayText="Fragment - "+this.displayName,this.program.program.__SPECTOR_rebuildProgram=this.rebuildShader.bind(this),clearInterval(this.checkProgramInterval))},e.prototype.rebuildShader=function(r,e,t,a){this.vertexShader=r,this.fragmentShader=e,this.magicUniforms=parseShaders(r,e),this.uniforms=Object.assign({},this.uniforms,magicUniformsToThree(this.magicUniforms)),this.needsUpdate=!0,this.bindUI(),t(this.program.program),this.checkProgramInterval=setInterval(this.checkProgram,200)},e}(RawShaderMaterial);export default MagicShader;export{gui};
//# sourceMappingURL=magicshader.mjs.map
